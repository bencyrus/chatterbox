api.glovee.io {
    # Add a unique UUID per request to the response headers
    header X-Request-ID {http.request.uuid}
    header X-Site "api.glovee.io"

    # Redirect any /docs* on the API host to the docs host
    handle_path /docs* {
        redir https://docs.glovee.io{uri} 301
    }

    # Forward all API requests to gateway
    reverse_proxy gateway:8080 {
        header_up X-Request-ID {http.request.uuid}
    }

    log {
        output stdout
        format json
    }
}

docs.glovee.io {
    # Add a unique UUID per request to the response headers
    header X-Request-ID {http.request.uuid}
    header X-Site "docs.glovee.io"

    # Serve the OpenAPI spec at /openapi.json via the gateway
    handle /openapi.json {
        reverse_proxy gateway:8080 {
            header_up X-Request-ID {http.request.uuid}
        }
    }

    # All other paths serve Swagger UI (index + static assets)
    reverse_proxy swaggerui:8080 {
        header_up X-Request-ID {http.request.uuid}
    }

    log {
        output stdout
        format json
    }
}
