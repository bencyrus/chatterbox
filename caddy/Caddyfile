api.glovee.io {
    log {
        output stdout
        format json
    }

    # Test: Add headers based on request headers before proxying
    @has_refresh_token header X-Refresh-Token *
    
    handle @has_refresh_token {
        # Add test headers before proxying
        header_down X-Refresh-Token-Detected "yes-before-proxy"
        
        reverse_proxy postgrest:3000 {
            # Add test headers to the response
            header_down X-Refresh-Token-Value {http.request.header.X-Refresh-Token}
        }
    }
    
    handle {
        reverse_proxy postgrest:3000
    }
}