api.glovee.io {
    # Add a unique UUID per request to the response headers
    header X-Request-ID {http.request.uuid}

    # Forward the same UUID to the upstream service as a request header
    reverse_proxy gateway:8080 {
        header_up X-Request-ID {http.request.uuid}
    }

    log {
        output stdout
        format filter {
            fields {
                # Use the response header as the canonical request_id
                resp_headers>X-Request-Id rename request_id
                resp_headers>X-Request-ID rename request_id
                # Drop duplicates/noise
                uuid delete
                request>headers>X-Request-Id delete
                request>headers>X-Request-ID delete
            }
            wrap json
        }
    }
}
