api.glovee.io {
    log {
        output stdout
        format json
    }

    # Simple approach: intercept successful responses and add token headers
    reverse_proxy postgrest:3000 {
        @needs_refresh {
            status 2xx
            header X-Refresh-Token *
        }
        
        handle_response @needs_refresh {
            # Simple test - just add a header to confirm this is working
            header X-Refresh-Token-Detected "yes"
            header X-Original-Refresh-Token {http.request.header.X-Refresh-Token}
            copy_response
        }
    }
}