api.glovee.io {
    log {
        output stdout
        format json
    }

    # Handle requests with refresh token
    @has_refresh_token header X-Refresh-Token *
    
    handle @has_refresh_token {
        reverse_proxy postgrest:3000 {
            # Add headers to successful responses  
            @success status 2xx
            handle_response @success {
                # Add indication that tokens should be refreshed
                header X-Should-Refresh-Tokens "true"
                header X-Refresh-Token-Present {http.request.header.X-Refresh-Token}
                copy_response
            }
        }
    }
    
    # Handle all other requests normally
    handle {
        reverse_proxy postgrest:3000
    }
}